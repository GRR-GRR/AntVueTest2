<template>
	<div id="fh5co-main">
		<div class="container">
			<div class="row">
        <div v-masonry transition-duration="0.3s" item-selector=".item">
          <div v-masonry-tile class="item" v-for="(photo, index) in blocks">
         <!-- block item markup -->
         {{ blocks }}
              <!-- <PhotoComponent class="item" v-for="(photo, index) in item.photos" :imageLink="photo.original_size.url" :imageUrl="photo.original_size.url" :key="index"></PhotoComponent> -->
          </div>
        </div>
				<div id="fh5co-board" class="grid" data-columns>
          <div v-for="(item, index) in objectPost">
            <!-- <PhotoComponent class="item" v-for="(photo, index) in item.photos" :imageLink="photo.original_size.url" :imageUrl="photo.original_size.url" :key="index"></PhotoComponent> -->
          </div>
<!--           <div class="item" v-for="(photo, index) in flickrPhotoUrl">
            <PhotoComponent :imageLink="photo" :imageUrl="photo" :key="index"></PhotoComponent>
          </div> -->
        </div>
			</div>
    </div>
	</div>
</template>

<script>

import PhotoComponent from './PhotoComponent.vue'
import {VueMasonryPlugin} from 'vue-masonry'

const salvattore = require('salvattore')
const $ = require('jquery')
require('magnific-popup')
Vue.use(VueMasonryPlugin)

import Vue from 'vue'

export default {
  components: {
    PhotoComponent
  },
  name: 'main',
  data () {
    return {
      msg: 'ceci est le main',
      client: 'hTqVY9D2OGTUQOYP7TzJYbXachJOqdyYfMJmI2SdhRdleQQ9qF',
      limit: 12,
      offset: 0,
      objectBlog: '',
      objectPost: [],
      selectedSize: 800,
      flickrPhotoSet: [],
      flickrPhotoUrl: [],
      window: $(window),
      blocks: []
    }
  },
  created () {
    console.log('ready')
  },
  methods: {
    tumblrGet () {
      this.$http.get('http://api.tumblr.com/v2/blog/grrgrr.tumblr.com/posts/photo?api_key=' + this.client + '&limit=' + this.limit + '&offset=' + this.offset).then((response) => {
        // console.log(response.data.response)
        this.objectBlog = response.blog
        this.blocks = this.objectPost.concat(response.data.response.posts)
        this.msg = response.data.response.blog.title
        this.objectPost = this.objectPost.concat(response.data.response.posts)
        this.popUp()
        Vue.nextTick(function () {
          salvattore.recreateColumns(document.getElementById('fh5co-board'))
        })
      })
    },
    FlickrGet () {
      console.log('hello')
      this.$http.get('https://api.flickr.com/services/rest/?method=flickr.photosets.getPhotos&api_key=75339da571d41004ca62e8a46e0e5798&photoset_id=72157627176334991&user_id=21589489%40N04&media=photos&format=json&nojsoncallback=1').then((photoSet) => {
        this.flickrPhotoSet = photoSet.data.photoset.photo
        console.log(photoSet.data.photoset.photo)
        this.flickrPhotoSet.some(function (photo, i) {
          if (i < 10) {
            this.$http.get('https://api.flickr.com/services/rest/?method=flickr.photos.getSizes&api_key=75339da571d41004ca62e8a46e0e5798&photo_id=' + photo.id + '&format=json&nojsoncallback=1').then((photoDetails) => {
              /* console.log(photoDetails.data.sizes.size[11].source) */
              this.flickrPhotoUrl.push(photoDetails.data.sizes.size[5].source)
            })
          }
          if (i === 10) {
            Vue.nextTick(function () {
              console.log(document.getElementById('fh5co-board'))
              salvattore.recreateColumns(document.getElementById('fh5co-board'))
            })
            return true
          }
        }.bind(this))
      })
    },
    infiniteScroll () {
      let self = this
      console.log(window.innerHeight, window.scrollY, $(document).height())
        // End of the document reached?
      if ($(document).height() - window.innerHeight === window.scrollY) {
        // $('#loading').show();
        self.offset += self.limit
        console.log(self.offset)
        // run ajax call and pass parameter from search
        self.tumblrGet()
        // salvattore.recreateColumns(document.getElementById('fh5co-board'))
      }
    },
    popUp () {
      $('#fh5co-board').magnificPopup({
        delegate: 'a',
        /*
        child items selector, by clicking on it popup will open
        */
        type: 'image',
        gallery: {
          /*
          options for gallery
          */
          enabled: true
        }
      })
    }
  },
  mounted () {
    console.log('component ok pour le main et api tumblr')
    // this.FlickrGet()
    this.tumblrGet()
    this.window.scroll(this.infiniteScroll)
  }
}
</script>
<style>
/*
 Spezific styling for salvattore
 Feel free to edit it as you like
 More info at http://salvattore.com
*/

/* Base styles */
.column {
    float: left;
}

@media screen and (max-width: 480px) {
  .column {
      float: none;
      position: relative;
      clear: both;
  }
}
.size-1of4 {
    width: 25%;
}
.size-1of3 {
    width: 33.333%;
}
.size-1of2 {
    width: 50%;
}

#fh5co-board[data-columns]::before {
    content: '4 .column.size-1of4';
}

/* Configurate salvattore with media queries */
@media screen and (max-width: 450px) {
    #fh5co-board[data-columns]::before {
        content: '1 .column';
    }
}

@media screen and (min-width: 451px) and (max-width: 700px) {
    #fh5co-board[data-columns]::before {
        content: '2 .column.size-1of2';
    }
}

@media screen and (min-width: 701px) and (max-width: 850px) {
    #fh5co-board[data-columns]::before {
        content: '3 .column.size-1of3';
    }
}

@media screen and (min-width: 851px) {
    #fh5co-board[data-columns]::before {
        content: '4 .column.size-1of4';
    }
}
</style>